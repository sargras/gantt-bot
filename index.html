<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能甘特图语音助手</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.css">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <header class="header">
            <h1>🗓️ 智能甘特图助手</h1>
            <p class="subtitle">语音控制 · 智能编辑 · 全平台支持</p>
            <div class="platform-indicator" id="platformIndicator">💻 检测设备中...</div>
        </header>

        <!-- 甘特图区域 -->
        <section class="gantt-section">
            <div class="section-header">
                <h2 id="projectTitle">📊 项目甘特图</h2>
                <div class="gantt-controls">
                    <button class="control-btn" onclick="changeViewMode('Day')">日视图</button>
                    <button class="control-btn active" onclick="changeViewMode('Week')">周视图</button>
                    <button class="control-btn" onclick="changeViewMode('Month')">月视图</button>
                    <button class="control-btn" onclick="exportAsImage()">📷 导出图片</button>
                    <button class="control-btn" onclick="exportProjectData()">💾 导出数据</button>
                </div>
            </div>
            <div id="gantt-container" class="gantt-container">
                <div class="placeholder">
                    <div class="placeholder-icon">📈</div>
                    <div class="placeholder-text">等待生成甘特图</div>
                    <div class="placeholder-hint">使用语音或文本指令创建项目计划</div>
                </div>
            </div>
        </section>

        <!-- 输入控制区域 -->
        <section class="control-section">
            <div class="section-header">
                <h2>🎤 智能输入</h2>
                <div class="input-methods">
                    <button class="method-btn active" onclick="switchInputMethod('voice')">语音输入</button>
                    <button class="method-btn" onclick="switchInputMethod('text')">文本输入</button>
                </div>
            </div>

            <!-- 语音输入区域 -->
            <div id="voiceArea" class="input-area active">
                <div class="voice-controls">
                    <button id="voiceButton" class="voice-btn" onclick="handleVoiceInput()">
                        <span class="voice-icon">🎤</span>
                        <span id="voiceText">点击开始语音输入</span>
                    </button>
                    <div class="voice-status">
                        <span id="voiceStatus">准备就绪</span>
                        <span class="recording-dot" id="recordingDot"></span>
                    </div>
                </div>
                
                <div class="device-guide" id="deviceGuide">
                    <!-- 设备指南动态生成 -->
                </div>
            </div>

            <!-- 文本输入区域 -->
            <div id="textArea" class="input-area">
                <textarea id="textInput" placeholder="请输入指令...&#10;&#10;示例指令：&#10;• 创建网站项目，三周时间&#10;• 添加测试任务，需要5天&#10;• 把开发时间延长到10天&#10;• 删除文档编写任务"></textarea>
                
                <div class="time-help">
                    <strong>💡 时间格式支持：</strong>
                    <span>3天、2周、下周一开始、明天开始、2024-01-01开始</span>
                </div>
            </div>

            <!-- 操作按钮 -->
            <div class="action-buttons">
                <button class="btn-primary" onclick="processCommand()">🚀 执行指令</button>
                <button class="btn-secondary" onclick="showHelp()">❓ 指令帮助</button>
                <button class="btn-import" onclick="importProjectData()">📁 导入数据</button>
                <button class="btn-tertiary" onclick="clearAll()">🗑️ 清空重来</button>
            </div>

            <!-- 快速指令按钮 -->
            <div class="quick-commands">
                <h4>⚡ 快速操作</h4>
                <div class="quick-buttons">
                    <button class="quick-btn" onclick="quickCommand('create')">📋 创建项目</button>
                    <button class="quick-btn" onclick="quickCommand('add')">➕ 添加任务</button>
                    <button class="quick-btn" onclick="quickCommand('edit')">✏️ 编辑任务</button>
                    <button class="quick-btn" onclick="quickCommand('delete')">🗑️ 删除任务</button>
                </div>
            </div>
        </section>

        <!-- 指令帮助面板 -->
        <div id="helpPanel" class="help-panel">
            <div class="panel-header">
                <h3>💡 智能指令手册</h3>
                <button class="close-btn" onclick="hideHelp()">×</button>
            </div>
            <div class="help-content">
                <div class="command-category">
                    <h4>📋 创建项目</h4>
                    <div class="command-item">
                        <code>"创建网站开发项目，三周时间"</code>
                        <span>新建项目并自动分配时间</span>
                    </div>
                    <div class="command-item">
                        <code>"开始新产品计划，明天启动"</code>
                        <span>指定开始时间创建项目</span>
                    </div>
                </div>
                
                <div class="command-category">
                    <h4>➕ 添加任务</h4>
                    <div class="command-item">
                        <code>"添加测试任务，需要5天"</code>
                        <span>在项目末尾添加新任务</span>
                    </div>
                    <div class="command-item">
                        <code>"在开发后加入代码评审，3天时间"</code>
                        <span>在特定任务后插入任务</span>
                    </div>
                </div>
                
                <div class="command-category">
                    <h4>✏️ 编辑任务</h4>
                    <div class="command-item">
                        <code>"把开发时间延长到10天"</code>
                        <span>调整任务持续时间</span>
                    </div>
                    <div class="command-item">
                        <code>"将测试提前两天开始"</code>
                        <span>调整任务开始时间</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 消息提示 -->
        <div id="messageToast" class="toast"></div>

        <!-- 隐藏的文件输入 -->
        <input type="file" id="fileInput" accept=".json" style="display: none;">
                <!-- 语音输入引导提示框 -->
        <div id="voiceGuideModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🎤 语音输入引导</h3>
                    <button class="close-btn" onclick="closeVoiceGuide()">×</button>
                </div>
                <div class="modal-body">
                    <div class="step-container">
                        <div class="step-item" id="step1">
                            <div class="step-icon">1</div>
                            <div class="step-content">
                                <div class="step-title">检查浏览器支持</div>
                                <div class="step-status" id="step1Status">等待检查...</div>
                            </div>
                        </div>
                        
                        <div class="step-item" id="step2">
                            <div class="step-icon">2</div>
                            <div class="step-content">
                                <div class="step-title">请求麦克风权限</div>
                                <div class="step-status" id="step2Status">等待授权...</div>
                            </div>
                        </div>
                        
                        <div class="step-item" id="step3">
                            <div class="step-icon">3</div>
                            <div class="step-content">
                                <div class="step-title">语音识别准备</div>
                                <div class="step-status" id="step3Status">等待启动...</div>
                            </div>
                        </div>
                        
                        <div class="step-item" id="step4">
                            <div class="step-icon">🎤</div>
                            <div class="step-content">
                                <div class="step-title">开始说话</div>
                                <div class="step-status" id="step4Status">请说话...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="voice-fallback" id="voiceFallback" style="display: none;">
                        <div class="fallback-title">📱 备用方案：使用设备自带语音输入</div>
                        <div class="fallback-steps">
                            <div class="fallback-step">
                                <span class="fallback-number">1</span>
                                <span>点击下方输入框</span>
                            </div>
                            <div class="fallback-step">
                                <span class="fallback-number">2</span>
                                <span>点击键盘上的🎤图标</span>
                            </div>
                            <div class="fallback-step">
                                <span class="fallback-number">3</span>
                                <span>开始说话，文字会自动填入</span>
                            </div>
                        </div>
                        <button class="btn-primary" onclick="useFallbackInput()">使用备用方案</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeVoiceGuide()">取消</button>
                    <button class="btn-primary" id="startVoiceBtn" onclick="startVoiceProcess()">开始语音输入</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
